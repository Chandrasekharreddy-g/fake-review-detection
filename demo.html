<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Fake Review Detector — Demo</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <main class="wrap">
      <div class="card">
        <h1>Interactive Demo</h1>
        <p class="lead">Paste a review below and click <strong>Predict</strong>. Uses a client heuristic and optionally calls the backend at <code>http://localhost:5000/predict</code>.</p>

        <textarea id="review" rows="8" placeholder="Paste review text here..."></textarea>
        <div class="controls">
          <button id="predict" class="btn primary">Predict (client)</button>
          <button id="predict-backend" class="btn">Predict (backend)</button>
          <div id="busy" style="display:none" class="spinner" aria-hidden="true"></div>
        </div>

        <div id="result" class="result">No prediction yet.</div>
      </div>
    </main>

    <script>
      function clientPredict(text) {
        const t = (text || '').trim();
        if (!t) return { label: 'No text', confidence: null };
        const len = t.length;
        const lower = t.toLowerCase();
        let score = 0;
        // short overly positive reviews -> likely fake
        if (len < 40) score += 1;
        if (/\b(amazing|best|incredible|perfect|must try)\b/.test(lower)) score += 1;
        if (/!{2,}/.test(lower)) score += 1;
        if (len > 200) score -= 1;
        const prob = Math.min(Math.max((score + 1) / 3, 0), 1);
        return { label: prob > 0.6 ? 'Fake' : 'Genuine', confidence: prob };
      }

      document.getElementById('predict').addEventListener('click', () => {
        const text = document.getElementById('review').value;
        const res = clientPredict(text);
        const out = document.getElementById('result');
        out.innerHTML = `<p><strong>Client prediction:</strong> ${res.label}${res.confidence!=null?` — confidence ${res.confidence.toFixed(2)}`:''}</p>`;
      });

      document.getElementById('predict-backend').addEventListener('click', async () => {
        const text = document.getElementById('review').value;
        const out = document.getElementById('result');
        out.innerHTML = '<em>Calling backend...</em>';
        try {
          const resp = await fetch('http://localhost:5000/predict', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ review: text })
          });
          const data = await resp.json();
          if (!resp.ok) throw new Error(data.error || JSON.stringify(data));
          out.innerHTML = `<p><strong>Backend prediction:</strong> ${data.prediction}${data.confidence?` — confidence ${data.confidence.toFixed(3)}`:''}</p>`;
        } catch (err) {
          out.innerHTML = `<p style="color:#900"><strong>Backend call failed:</strong> ${err.message}</p>`;
        }
      });
    </script>
  </body>
</html>
